# Лабораторная работа №4  
## Обработка ошибок, валидация и логгирование в Node.js (Express)

---

## 1. Общая информация

**Дисциплина:** Backend-разработка на Node.js  
**Лабораторная работа №4**  
**Тема:** Обработка ошибок, валидация и логгирование  
**Базовый проект:** ToDo REST API с JWT-аутентификацией (ЛР №3)  
**Среда разработки:** Visual Studio Code  
**Платформа:** Node.js + Express  
**База данных:** PostgreSQL  

---

## 2. Цель лабораторной работы

Целью данной лабораторной работы является изучение и практическая реализация:

- централизованной обработки ошибок;
- валидации входящих данных;
- логгирования запросов и ошибок;
- интеграции сервиса Sentry для мониторинга ошибок.

---

## 3. Задание

Продолжить разработку приложения ЛР №3 и реализовать:

1. Централизованный обработчик ошибок.
2. Пользовательские классы ошибок.
3. Валидацию данных с помощью express-validator.
4. Логгирование через winston и morgan.
5. Интеграцию с Sentry.
6. Исключение ошибок валидации из Sentry.

---

## 4. Структура проекта

```bash
src/
 ├── errors/
 │   ├── AppError.js
 │   ├── ValidationError.js
 │   └── NotFoundError.js
 ├── middlewares/
 │   ├── errorHandler.js
 │   └── validate.js
 ├── validators/
 │   ├── authValidator.js
 │   └── todoValidator.js
 ├── utils/
 │   └── asyncHandler.js
 └── logger/
     └── logger.js

```

---

## 5. Реализация обработки ошибок

Все ошибки в приложении обрабатываются централизованно через middleware `errorHandler.js`.
Используются пользовательские классы ошибок:

- AppError — базовый класс;
- ValidationError — ошибки валидации;
- NotFoundError — ресурс не найден.

Формат ответа:
{
  "status": "error",
  "message": "Описание ошибки"
}

---

## 6. Валидация входящих данных

Для проверки данных используется библиотека `express-validator`.

Пример валидации входа:
- Проверка корректности email;
- Проверка длины пароля.

При ошибке валидации возвращается статус 400 и массив ошибок.

---

## 7. Логгирование

Для логгирования используется:

- winston — для серверных логов;
- morgan — для логирования HTTP-запросов.

Логи сохраняются в папку `/logs` с ежедневной ротацией.

---

## 8. Интеграция Sentry

Sentry используется для мониторинга ошибок в реальном времени.

В Sentry отправляются только серверные ошибки.
Ошибки валидации в Sentry не отправляются.

---

## 9. Проверка работы

1. Отправить некорректные данные при входе.
2. Убедиться, что сервер возвращает ошибку 400.
3. Проверить появление записи в лог-файле.
4. Проверить отправку ошибок в Sentry (кроме ошибок валидации).

---

## 10. Контрольные вопросы

### 1. Преимущества централизованной обработки ошибок

- Единый формат ошибок.
- Удобная поддержка.
- Интеграция с логгированием и Sentry.
- Отсутствие повторений try/catch.

### 2. Категории логов

- HTTP-запросы.
- Ошибки сервера.
- Ошибки валидации.
- Успешные операции.

Выбраны для мониторинга, отладки и аудита.

### 3. Подходы к валидации данных

- Ручная проверка.
- express-validator.
- Joi.
- Yup.

В работе использован express-validator.

---

## 11. Вывод

В ходе лабораторной работы были реализованы механизмы безопасной обработки ошибок, валидации и логгирования, что повысило надежность и устойчивость backend-приложения.
